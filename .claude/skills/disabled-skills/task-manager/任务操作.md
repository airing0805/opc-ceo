# 任务操作

## 功能概述

实现任务的增删改查（CRUD）操作，包括创建、读取、更新、删除任务，以及搜索和过滤功能。

## 操作命令

### 命令 1：创建任务

**用途**：创建新任务并存储到知识图谱

**语法**：
```
创建任务:
  - title: <任务标题>
  - description: <任务描述> (可选)
  - priority: <优先级> (可选，默认medium)
  - projectId: <项目ID> (可选)
  - tags: <标签> (可选，逗号分隔)
  - dueDate: <截止日期> (可选，格式YYYY-MM-DD)
  - estimatedMinutes: <估算时间> (可选，分钟)
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| title | string | 是 | 任务标题 |
| description | string | 否 | 任务详细描述 |
| priority | string | 否 | 优先级：critical/high/medium/low，默认medium |
| projectId | string | 否 | 所属项目ID，格式PROJ-NNN |
| tags | string | 否 | 标签，多个用逗号分隔 |
| dueDate | string | 否 | 截止日期，格式YYYY-MM-DD |
| estimatedMinutes | number | 否 | 估算时间，单位分钟 |

**示例**：
```
创建任务:
  - title: 完成项目文档
  - description: 编写 OPC-CEO 项目的技术文档
  - priority: high
  - projectId: PROJ-001
  - tags: documentation,technical
  - dueDate: 2026-03-01
  - estimatedMinutes: 120
```

---

### 命令 2：读取任务

**用途**：根据任务ID获取任务详情

**语法**：
```
读取任务:
  - taskId: <任务ID>
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| taskId | string | 是 | 任务ID，格式TASK-YYYY-MM-DD-NNN |

**示例**：
```
读取任务:
  - taskId: TASK-2026-02-23-001
```

---

### 命令 3：更新任务

**用途**：更新任务的属性（状态、优先级、描述等）

**语法**：
```
更新任务:
  - taskId: <任务ID>
  - updates:
      - status: <新状态> (可选)
      - priority: <新优先级> (可选)
      - description: <新描述> (可选)
      - dueDate: <新截止日期> (可选)
      - estimatedMinutes: <新估算时间> (可选)
      - actualMinutes: <实际耗时> (可选)
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| taskId | string | 是 | 任务ID |
| status | string | 否 | 新状态：todo/in_progress/blocked/completed/cancelled |
| priority | string | 否 | 新优先级：critical/high/medium/low |
| description | string | 否 | 新描述 |
| dueDate | string | 否 | 新截止日期 |
| estimatedMinutes | number | 否 | 新估算时间 |
| actualMinutes | number | 否 | 实际耗时 |

**示例**：
```
更新任务:
  - taskId: TASK-2026-02-23-001
  - updates:
      - status: in_progress
      - actualMinutes: 30
```

---

### 命令 4：删除任务

**用途**：删除任务（删除前检查依赖关系）

**语法**：
```
删除任务:
  - taskId: <任务ID>
  - force: <强制删除> (可选，默认false)
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| taskId | string | 是 | 任务ID |
| force | boolean | 否 | 是否强制删除（忽略依赖检查），默认false |

**示例**：
```
删除任务:
  - taskId: TASK-2026-02-23-001
```

---

### 命令 5：搜索任务

**用途**：根据条件搜索任务

**语法**：
```
搜索任务:
  - filters:
      - status: <状态> (可选)
      - priority: <优先级> (可选)
      - projectId: <项目ID> (可选)
      - tag: <标签> (可选)
      - dueDateBefore: <日期> (可选)
      - dueDateAfter: <日期> (可选)
  - sortBy: <排序字段> (可选，默认priority)
  - sortOrder: <排序顺序> (可选，默认desc)
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| status | string | 否 | 按状态过滤 |
| priority | string | 否 | 按优先级过滤 |
| projectId | string | 否 | 按项目过滤 |
| tag | string | 否 | 按标签过滤 |
| dueDateBefore | string | 否 | 截止日期之前 |
| dueDateAfter | string | 否 | 截止日期之后 |
| sortBy | string | 否 | 排序字段：priority/dueDate/createdAt |
| sortOrder | string | 否 | 排序顺序：asc/desc |

**示例**：
```
搜索任务:
  - filters:
      - status: todo
      - priority: high
  - sortBy: dueDate
  - sortOrder: asc
```

---

### 命令 6：设置任务依赖

**用途**：设置任务间的依赖关系

**语法**：
```
设置依赖:
  - fromTaskId: <依赖任务ID>
  - toTaskId: <被依赖任务ID>
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| fromTaskId | string | 是 | 依赖方任务ID |
| toTaskId | string | 是 | 被依赖方任务ID |

**示例**：
```
设置依赖:
  - fromTaskId: TASK-2026-02-23-002
  - toTaskId: TASK-2026-02-23-001
```

## MCP Memory 使用

### 创建任务实体

```
使用 mcp__memory__create_entities:
{
  "entities": [{
    "name": "TASK-2026-02-23-001: 完成项目文档",
    "entityType": "Task",
    "observations": [
      "title: 完成项目文档",
      "description: 编写 OPC-CEO 项目的技术文档",
      "status: todo",
      "priority: high",
      "projectId: PROJ-001",
      "tags: documentation,technical",
      "dueDate: 2026-03-01",
      "estimatedMinutes: 120",
      "createdAt: 2026-02-23T10:00:00",
      "updatedAt: 2026-02-23T10:00:00"
    ]
  }]
}
```

### 创建任务关系

```
使用 mcp__memory__create_relations:
{
  "relations": [{
    "from": "TASK-2026-02-23-001: 完成项目文档",
    "to": "PROJ-001: OPC-CEO",
    "relationType": "belongsTo"
  }]
}
```

### 更新任务

```
使用 mcp__memory__add_observations:
{
  "observations": [{
    "entityName": "TASK-2026-02-23-001: 完成项目文档",
    "contents": [
      "status: in_progress",
      "updatedAt: 2026-02-23T14:00:00"
    ]
  }]
}
```

### 搜索任务

```
使用 mcp__memory__search_nodes:
{
  "query": "Task status:todo priority:high"
}
```

### 打开任务

```
使用 mcp__memory__open_nodes:
{
  "names": ["TASK-2026-02-23-001: 完成项目文档"]
}
```

### 删除任务

```
使用 mcp__memory__delete_entities:
{
  "entityNames": ["TASK-2026-02-23-001: 完成项目文档"]
}
```

## 错误处理

| 错误类型 | 处理方式 |
|---------|---------|
| 任务不存在 | 返回错误提示，建议检查任务ID |
| 任务已完成且试图修改 | 提示任务已完成，不能修改 |
| 删除任务有依赖 | 提示依赖关系，需要先处理依赖或使用force |
| 优先级值无效 | 提示有效的优先级选项 |
| 状态转换无效 | 提示有效的状态转换 |

## 任务ID生成规则

任务ID格式：`TASK-YYYY-MM-DD-NNN`

- 生成时使用当前日期
- NNN 为当天任务序号，从001开始递增
- 需要查询当天已有任务数量来确定序号

## 相关模块

- [任务流转](任务流转.md) - 任务状态转换
- [任务统计](任务统计.md) - 统计报告
- [任务模板](任务模板.md) - 任务模板

# 协调流程

## 功能概述

定义多角色协作模式，处理复杂跨角色任务。

## 操作命令

### 命令 1：单角色任务

**用途**：分配给单一角色的简单任务

**语法**：
```
分配单角色任务:
- 任务ID: <任务标识>
- 角色: <角色名>
- 任务描述: <描述>
- 验收标准: [标准列表]
- 超时: <分钟数>
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| 任务ID | string | 是 | 任务唯一标识 |
| 角色 | string | 是 | 执行角色 |
| 任务描述 | string | 是 | 任务详细描述 |
| 验收标准 | array | 是 | 验收标准列表 |
| 超时 | number | 否 | 超时时间（分钟） |

**示例**：
```
分配单角色任务:
- 任务ID: TASK-2026-02-23-001
- 角色: file-manager
- 任务描述: 整理项目目录下的所有文档文件
- 验收标准: [文档已分类, 有序排列, 无重复文件]
- 超时: 30
```

### 命令 2：多角色协调

**用途**：需要多个角色协作的复杂任务

**语法**：
```
协调多角色任务:
- 任务ID: <任务标识>
- 主角色: <角色名>
- 协作角色: [角色列表]
- 任务描述: <描述>
- 执行步骤: [步骤列表]
- 依赖关系: [依赖列表]
- 验收标准: [标准列表]
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| 任务ID | string | 是 | 任务唯一标识 |
| 主角色 | string | 是 | 负责协调的主角色 |
| 协作角色 | array | 是 | 协作角色列表 |
| 任务描述 | string | 是 | 任务详细描述 |
| 执行步骤 | array | 是 | 执行步骤顺序 |
| 依赖关系 | array | 否 | 步骤间的依赖关系 |
| 验收标准 | array | 是 | 验收标准列表 |

**示例**：
```
协调多角色任务:
- 任务ID: TASK-2026-02-23-002
- 主角色: opc-ceo-core
- 协作角色: [file-manager, knowledge-manager]
- 任务描述: 整理项目文件并更新知识库
- 执行步骤:
    - 步骤1: file-manager 整理文件
    - 步骤2: knowledge-manager 更新知识库
- 依赖关系: [步骤2依赖步骤1]
- 验收标准: [文件已整理, 知识库已更新]
```

### 命令 3：并行协调

**用途**：多个角色同时执行独立任务

**语法**：
```
并行协调任务:
- 任务ID: <任务标识>
- 并行任务: [任务列表]
- 汇总标准: [标准列表]
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| 任务ID | string | 是 | 主任务ID |
| 并行任务 | array | 是 | 并行执行的子任务列表 |
| 汇总标准 | array | 是 | 结果汇总标准 |

**示例**：
```
并行协调任务:
- 任务ID: TASK-2026-02-23-003
- 并行任务:
    - 任务1: file-manager 整理文档
    - 任务2: task-manager 检查任务状态
    - 任务3: finance-manager 生成周报
- 汇总标准: [所有子任务完成, 结果汇总完整]
```

## 协调模式

### 串行模式

```
任务A ──► 任务B ──► 任务C
```

- 适用：有依赖关系的任务
- 优点：顺序清晰，便于调试
- 缺点：总时间长

### 并行模式

```
任务A ──┐
         ├───► 汇总
任务B ──┘
```

- 适用：无依赖关系的任务
- 优点：节省时间
- 缺点：资源消耗大

### 混合模式

```
任务A ──► 任务B ──┐
                  ├───► 汇总
任务C ──► 任务D ──┘
```

- 适用：部分有依赖，部分无依赖
- 优点：兼顾效率和顺序
- 缺点：流程复杂

## MCP Memory 使用

### 创建协调记录

```
使用 mcp__memory__create_entities:
{
  "name": "COORD-2026-02-23-001",
  "entityType": "Coordination",
  "observations": [
    "taskId: TASK-2026-02-23-002",
    "pattern: 串行",
    "roles: [opc-ceo-core, file-manager, knowledge-manager]",
    "steps: 2",
    "status: in_progress",
    "startTime: 2026-02-23T10:00:00"
  ]
}
```

### 创建依赖关系

```
使用 mcp__memory__create_relations:
{
  "from": "TASK-2026-02-23-002-STEP2",
  "to": "TASK-2026-02-23-002-STEP1",
  "relationType": "dependsOn"
}
```

## 协调质量评估

| 维度 | 合格 | 优秀 | 卓越 |
|------|------|------|------|
| 按时完成 | 100% | 提前10% | 提前20%+ |
| 质量达标 | 所有标准 | 超出预期 | 超出明显 |
| 角色协作 | 无冲突 | 配合默契 | 高效协同 |
| 资源利用 | 合理 | 优化 | 最优 |

## 错误处理

| 错误类型 | 处理方式 |
|----------|----------|
| 角色执行失败 | 分析原因，重试或更换角色 |
| 超时未完成 | 评估进度，调整策略 |
| 依赖关系错误 | 重新设计流程 |

## 相关模块

- [决策支持](决策支持.md) - 决策协调策略
- [能力边界](能力边界.md) - 判断角色能力
- [任务检查](任务检查.md) - 验收协调结果

# 文件备份

## 功能概述

定义文件备份与同步策略，确保数据安全。

## 备份策略

### 备份频率

| 类型 | 频率 | 说明 |
|------|------|------|
| 即时备份 | 关键文件修改后 | 重要配置文件、关键文档 |
| 每日备份 | 每天一次 | 工作目录、文档目录 |
| 每周备份 | 每周一次 | 项目文件完整备份 |

### 备份位置

| 内容 | 源目录 | 备份目录 |
|------|----------|----------|
| 项目文件 | `E:\workspaces_2026_python\OPC-CEO` | `E:\Backups\OPC-CEO\` |
| 文档文件 | `E:\Documents` | `E:\Backups\Documents\` |
| 配置文件 | 用户配置目录 | `E:\Backups\Config\` |

---

## 操作命令

### 命令 1：备份目录

**用途**：备份指定目录

**语法**：
```
备份目录:
  - source: <源目录>
  - destination: <目标目录> (可选，默认备份目录)
  - incremental: <增量备份> (可选，默认true)
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| source | string | 是 | 源目录路径 |
| destination | string | 否 | 目标目录，默认备份目录 |
| incremental | boolean | 否 | 是否增量备份，默认 true |

**示例**：
```
备份目录:
  - source: E:\workspaces_2026_python\OPC-CEO
  - destination: E:\Backups\OPC-CEO\
  - incremental: true
```

---

### 命令 2：备份文件

**用途**：备份单个文件

**语法**：
```
备份文件:
  - source: <源文件>
  - destination: <目标文件> (可选)
```

**参数**：

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| source | string | 是 | 源文件路径 |
| destination | string | 否 | 目标文件，自动确定 |

**示例**：
```
备份文件:
  - source: E:\Documents\关键设计.md
```

---

### 命令 3：验证备份

**用途**：验证备份完整性

**语法**：
```
验证备份:
  - backupPath: <备份路径>
  - sourcePath: <源路径> (可选)
```

**验证内容**：
- 文件数量对比
- 文件大小对比
- 关键文件完整性检查

**示例**：
```
验证备份:
  - backupPath: E:\Backups\OPC-CEO\
  - sourcePath: E:\workspaces_2026_python\OPC-CEO
```

---

### 命令 4：恢复备份

**用途**：从备份恢复文件

**语法**：
```
恢复备份:
  - backupPath: <备份文件>
  - destination: <恢复位置> (可选，默认原位置)
```

**示例**：
```
恢复备份:
  - backupPath: E:\Backups\Documents\设计文档.md
  - destination: E:\Documents\
```

---

## MCP Memory 使用

### 执行备份命令

```
使用 Bash 工具执行 robocopy (Windows):
{
  "command": "robocopy \"E:\\workspaces_2026_python\\OPC-CEO\" \"E:\\Backups\\OPC-CEO\" /E /XO /R:2 /W:0"
}

参数说明：
- /E: 复制子目录（包括空目录）
- /XO: 排除已存在的较旧文件
- /R:2: 失败重试 2 次
- /W:0: 等待 0 秒
```

### 验证备份

```
使用 Bash 工具执行 robocopy 验证:
{
  "command": "robocopy \"E:\\workspaces_2026_python\\OPC-CEO\" \"E:\\Backups\\OPC-CEO\" /L"
}

参数说明：
- /L: 仅列出将要复制的文件（不实际复制）
```

---

## 备份工具

### Windows (robocopy)

| 参数 | 说明 |
|------|------|
| `/E` | 复制所有子目录 |
| `/XO` | 排除已存在的较旧文件 |
| `/PURGE` | 删除目标中不再存在的文件 |
| `/MIR` | 镜像目录（完全同步） |
| `/R:n` | 失败重试 n 次 |
| `/W:n` | 等待 n 秒 |

### Linux/Mac (rsync)

| 参数 | 说明 |
|------|------|
| `-a` | 归档模式（保留所有属性） |
| `-v` | 详细输出 |
| `--delete` | 删除目标中不再存在的文件 |
| `--backup` | 备份已存在的文件 |

---

## 备份命名规范

```
E:\Backups\
├── OPC-CEO\
│   ├── 2026-02-23\
│   └── latest\
└── Documents\
    ├── 2026-02-23\
    └── latest\
```

---

## 相关模块

- [文件操作](文件操作.md) - 文件 CRUD 操作
- [文件组织](文件组织.md) - 文件分类规则

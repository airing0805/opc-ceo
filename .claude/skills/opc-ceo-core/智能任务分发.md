# 智能任务分发（V6.0）

> 本模块从 SKILL.md 拆分，定义六級任务分发机制和动态复杂度评分。
>
> **V6.0 新增**：L0 快速路径、协作超时机制

---

## 六級分发机制（V6.0）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     V6.0 六級任务分发机制                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   任务输入                                                               │
│      │                                                                  │
│      ▼                                                                  │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ 复杂度评分 (动态调整)                                               │   │
│   │ - 文件数 × 操作类型系数 × 依赖度 × 历史调整因子                      │   │
│   └──────────────────────────┬──────────────────────────────────────┘   │
│                              │                                           │
│   ┌──────────┬───────────────┼───────────────┬──────────┬──────────┐  │
│   │          │               │               │          │          │  │
│   ▼          ▼               ▼               ▼          ▼          ▼  │
│  L0         L1              L2              L3         L4        L5  │
│  <1         1-2             2-4             4-6        6-8       >8  │
│   │          │               │               │          │          │  │
│   ▼          ▼               ▼               ▼          ▼          ▼  │
│ 快速执行   直接执行         MCP工具         Agent       Team       拆分+  │
│ 1秒        单文件           文档优先        专项执行    协调        递归   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 分发规则表

| 级别 | 复杂度范围 | 执行方式 | 典型场景 | 决策时间 |
|------|-----------|----------|----------|----------|
| **L0** | < 1 | 快速执行 | 状态查询、文件读取、简单确认 | 1秒 |
| L1 | 1-2 | 直接执行 | 单文件读取、简单查询 | 3秒 |
| L2 | 2-4 | **MCP 工具优先** | 文档创建/编辑/写入 | 3秒 |
| L3 | 4-6 | Agent 执行 | 跨文件操作、知识推理 | 10秒 |
| L4 | 6-8 | Team 协调 | 多角色任务、复杂流程 | 10秒 |
| L5 | > 8 | 拆分+递归 | 超复杂任务分解 | 30秒 |

---

## L0 快速路径（V6.0 新增）

### 适用场景

| 场景 | 示例 | 复杂度 |
|------|------|--------|
| 状态查询 | "当前有什么任务" | 0.5 |
| 文件读取 | "读取任务分配.md" | 0.3 |
| 简单确认 | "确认任务状态" | 0.4 |
| 信息检索 | "搜索 XX 关键词" | 0.6 |

### 执行规则

```
L0 快速路径执行：
1. 复杂度 < 1 → 直接执行
2. 无需复杂度计算
3. 无需 Agent 调用
4. 直接使用 MCP 工具
5. 响应时间目标：1秒
```

---

## 动态复杂度评分

**优化后公式**：
```
复杂度 = 文件数 × 操作类型系数 × 依赖度 × 历史调整因子

历史调整因子 = f(历史执行数据)

调整规则：
1. 每10次执行后自动调整
2. 如果某类型任务平均超时 > 20%，提高该类型系数 10%
3. 如果某类型任务平均提前完成 > 30%，降低该类型系数 5%
4. 系数范围：0.5 ~ 3.0
```

---

## 基础系数表

| 操作类型 | 基础系数 | 动态范围 |
|----------|----------|----------|
| 读取 | 1.0 | 0.5 ~ 1.5 |
| 写入 | 1.5 | 0.75 ~ 2.25 |
| 修改 | 1.8 | 0.9 ~ 2.7 |
| 删除 | 2.0 | 1.0 ~ 3.0 |

---

## 协作超时机制（V6.0 新增）

### 超时配置

| 协作类型 | 超时时间 | 超时处理 |
|----------|----------|----------|
| 子角色调用 | 30秒 | CEO 直接执行 |
| Agent 执行 | 60秒 | 汇报进度 |
| Team 协调 | 120秒 | 拆分任务 |

### 超时处理流程

```
协作超时
    │
    ├── 子角色超时
    │   └── CEO 直接执行 → 记录问题
    │
    ├── Agent 超时
    │   └── 汇报进度 → 询问继续
    │
    └── Team 超时
        └── 拆分任务 → 分批执行
```

### 超时配置 JSON

```json
{
  "collaboration": {
    "subRole": {
      "timeout": 30000,
      "fallback": "ceo_direct"
    },
    "agent": {
      "timeout": 60000,
      "fallback": "report_progress"
    },
    "team": {
      "timeout": 120000,
      "fallback": "split_task"
    }
  }
}
```

---

> 返回：[SKILL.md](SKILL.md) | 相关模块：[MCP工具使用.md](MCP工具使用.md) | [并行任务识别.md](并行任务识别.md) | [底层执行能力.md](底层执行能力.md)

# 自媒体 Agent 系统技术选型

> **版本**: V1.0  
> **日期**: 2026-02-27  
> **状态**: 草案  
> **任务ID**: v22.5

---

## 一、选型原则

### 1.1 核心原则

| 原则 | 说明 | 优先级 |
|------|------|--------|
| **快速迭代** | 优先选择能快速实现 MVP 的技术 | P0 |
| **成熟稳定** | 选择社区活跃、文档完善的技术 | P0 |
| **易于维护** | 代码结构清晰，便于后期扩展 | P1 |
| **成本可控** | 开发成本和运行成本均在可控范围 | P1 |
| **一人友好** | 适合一人开发团队的技术栈 | P0 |

### 1.2 选型约束

| 约束 | 说明 |
|------|------|
| 开发人员 | 1人 |
| 开发周期 | Q2（3个月） |
| 预算 | 低成本优先 |
| 部署环境 | 本地运行优先 |

---

## 二、核心技术选型

### 2.1 Agent 框架

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **Claude Agent SDK** | 原生支持 Claude、与现有系统集成方便、无需学习新框架 | 功能相对简单 | ⭐⭐⭐⭐⭐ |
| LangChain | 功能丰富、社区活跃、生态完善 | 学习曲线陡峭、过度抽象 | ⭐⭐⭐⭐ |
| AutoGPT | 自动化程度高 | 不稳定、资源消耗大 | ⭐⭐ |
| CrewAI | 多 Agent 协作友好 | 相对新、文档不足 | ⭐⭐⭐ |
| 自研框架 | 完全可控 | 开发成本高 | ⭐⭐⭐ |

#### 推荐方案：Claude Agent SDK + 自研轻量框架

**理由**：
1. 与现有 OPC-CEO 系统无缝集成
2. 利用 Claude Code 现有能力
3. 无需额外学习成本
4. 可根据需要逐步自研扩展

**架构设计**：

```
┌─────────────────────────────────────────────────────────────┐
│                    Agent 框架架构                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Claude Agent SDK (核心)                 │   │
│  │                                                       │   │
│  │  - 消息路由                                          │   │
│  │  - 上下文管理                                        │   │
│  │  - 工具调用                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              自研扩展层                              │   │
│  │                                                       │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐           │   │
│  │  │任务调度  │  │状态管理  │  │错误处理  │           │   │
│  │  └──────────┘  └──────────┘  └──────────┘           │   │
│  │                                                       │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐           │   │
│  │  │平台适配  │  │数据持久化│  │日志追踪  │           │   │
│  │  └──────────┘  └──────────┘  └──────────┘           │   │
│  │                                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 数据存储

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **SQLite** | 轻量、无需安装、Python 内置 | 并发有限 | ⭐⭐⭐⭐⭐ |
| PostgreSQL | 功能强大、高并发 | 需要安装维护 | ⭐⭐⭐ |
| MongoDB | 灵活、文档存储 | 额外依赖 | ⭐⭐⭐ |
| **MCP Memory** | 与现有系统集成、知识图谱 | 不适合大量数据 | ⭐⭐⭐⭐ |
| JSON 文件 | 最简单、无依赖 | 查询效率低 | ⭐⭐⭐ |

#### 推荐方案：SQLite + MCP Memory + 文件系统

**存储分工**：

| 数据类型 | 存储方案 | 理由 |
|----------|----------|------|
| 结构化数据（指标、记录） | SQLite | 查询高效、统计方便 |
| 知识数据（选题、经验） | MCP Memory | 知识图谱、关联推理 |
| 内容文件（文章、素材） | 文件系统 | 版本管理、便于查看 |

**数据模型**：

```python
# SQLite 表结构
class Content(Base):
    __tablename__ = "contents"
    
    id: str           # 内容ID
    title: str        # 标题
    content: str      # 正文
    status: str       # 状态 (draft/published)
    platform: str     # 平台
    created_at: datetime
    published_at: datetime

class Metrics(Base):
    __tablename__ = "metrics"
    
    id: str
    content_id: str   # 关联内容
    platform: str
    views: int
    likes: int
    comments: int
    recorded_at: date

class PublishLog(Base):
    __tablename__ = "publish_logs"
    
    id: str
    content_id: str
    platform: str
    status: str       # success/failed
    url: str          # 发布链接
    error: str        # 错误信息
    created_at: datetime
```

### 2.3 任务调度

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **APScheduler** | Python 原生、简单易用 | 单进程 | ⭐⭐⭐⭐⭐ |
| Celery | 分布式、功能强大 | 依赖 Redis、复杂 | ⭐⭐⭐ |
| Cron | 系统原生、稳定 | 不灵活 | ⭐⭐⭐ |
| 自研调度 | 完全可控 | 开发成本 | ⭐⭐⭐ |

#### 推荐方案：APScheduler

**理由**：
1. Python 原生，无需额外依赖
2. 支持多种触发器（定时、间隔、日期）
3. 支持持久化存储
4. 与现有系统易于集成

**调度配置**：

```python
from apscheduler.schedulers.background import BackgroundScheduler
from apscheduler.triggers.cron import CronTrigger

scheduler = BackgroundScheduler()

# 每日数据采集（早上8点）
scheduler.add_job(
    collect_daily_metrics,
    trigger=CronTrigger(hour=8, minute=0),
    id="daily_metrics"
)

# 每日选题推荐（早上9点）
scheduler.add_job(
    generate_topic_recommendations,
    trigger=CronTrigger(hour=9, minute=0),
    id="daily_topics"
)

# 每周效果分析（周一10点）
scheduler.add_job(
    weekly_analysis,
    trigger=CronTrigger(day_of_week="mon", hour=10),
    id="weekly_analysis"
)

scheduler.start()
```

### 2.4 Web 框架（可选）

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **FastAPI** | 高性能、自动文档、类型提示 | 学习曲线 | ⭐⭐⭐⭐⭐ |
| Flask | 简单、灵活 | 功能较少 | ⭐⭐⭐⭐ |
| Django | 功能全面 | 过重 | ⭐⭐ |
| 无 Web | 最简单 | 无可视化 | ⭐⭐⭐ |

#### 推荐方案：FastAPI（按需）

**理由**：
1. 性能优秀，适合 API 服务
2. 自动生成 OpenAPI 文档
3. 类型提示，代码更健壮
4. 异步支持，适合 IO 密集型

**MVP 阶段可暂不使用，先用 Claude Code 交互。**

### 2.5 内容生成

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **Claude API** | 质量高、长文本支持好 | 成本较高 | ⭐⭐⭐⭐⭐ |
| GPT-4 | 能力强 | 成本高、国内访问问题 | ⭐⭐⭐⭐ |
| GPT-3.5 | 成本低 | 质量一般 | ⭐⭐⭐ |
| 文心一言 | 国内友好 | 质量待验证 | ⭐⭐⭐ |
| 本地模型 | 无 API 成本 | 需要算力、质量一般 | ⭐⭐ |

#### 推荐方案：Claude API（主力）

**理由**：
1. 长文本生成质量高
2. 与 Claude Code 生态一致
3. 支持系统提示词定制
4. 上下文窗口大

**模型选择**：

| 场景 | 推荐模型 | 理由 |
|------|----------|------|
| 长文创作 | Claude Sonnet 4 | 质量与成本平衡 |
| 大纲生成 | Claude Haiku 4 | 快速响应、低成本 |
| 选题推荐 | Claude Haiku 4 | 批量处理、成本敏感 |
| 质量检测 | Claude Haiku 4 | 简单任务 |

### 2.6 图片生成

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **DALL-E 3** | 质量高、API 方便 | 成本较高 | ⭐⭐⭐⭐ |
| Midjourney | 质量最高 | 无官方 API | ⭐⭐⭐ |
| Stable Diffusion | 开源、可本地 | 需要算力 | ⭐⭐⭐ |
| 图库（Unsplash） | 免费、高质量 | 非原创 | ⭐⭐⭐⭐ |
| 飞书设计/Canva | 模板丰富 | 手动操作 | ⭐⭐⭐⭐ |

#### 推荐方案：混合策略

| 用途 | 方案 | 理由 |
|------|------|------|
| 文章配图 | Unsplash + DALL-E 3 | 图库优先，特殊需求 AI |
| 封面设计 | 飞书设计/Canva | 模板化，质量稳定 |
| 品牌素材 | 专业设计 | 重要度高 |

---

## 三、平台集成技术

### 3.1 平台发布能力

| 平台 | 发布方式 | API 可用性 | 推荐方案 |
|------|----------|------------|----------|
| 知乎 | 官方 API | 有（需申请） | API + 模拟登录 |
| 简书 | 无官方 API | 无 | Selenium/Playwright |
| CSDN | 无官方 API | 无 | Selenium/Playwright |
| 掘金 | 无官方 API | 无 | Selenium/Playwright |
| 公众号 | 官方 API | 有 | API |
| B站 | 官方 API | 部分 | API + 模拟 |

### 3.2 数据采集技术

| 平台 | 采集方式 | 技术方案 |
|------|----------|----------|
| 知乎 | 公开数据 | requests + BeautifulSoup |
| 简书 | 公开数据 | requests + BeautifulSoup |
| CSDN | 公开数据 | requests + BeautifulSoup |
| 掘金 | 公开数据 | requests + BeautifulSoup |
| 公众号 | 需登录 | Playwright |
| B站 | 公开数据 | requests + API |

### 3.3 自动化工具选择

| 方案 | 优点 | 缺点 | 推荐指数 |
|------|------|------|----------|
| **Playwright** | 跨浏览器、稳定、支持无头 | 需要浏览器 | ⭐⭐⭐⭐⭐ |
| Selenium | 成熟、社区大 | 较重 | ⭐⭐⭐⭐ |
| Puppeteer | Node.js 生态好 | Python 支持弱 | ⭐⭐⭐ |
| requests | 轻量 | 动态页面难处理 | ⭐⭐⭐⭐ |

#### 推荐方案：Playwright + requests

- Playwright：处理需要渲染的页面、模拟登录
- requests：处理静态页面、API 调用

---

## 四、开发工具链

### 4.1 开发环境

| 工具 | 用途 | 推荐方案 |
|------|------|----------|
| 语言 | 主要开发语言 | Python 3.11+ |
| 包管理 | 依赖管理 | uv / pip |
| 版本控制 | 代码管理 | Git |
| IDE | 代码编辑 | VS Code / Cursor |
| 测试 | 单元测试 | pytest |
| 格式化 | 代码风格 | ruff / black |

### 4.2 项目结构

```
media-agent-system/
├── agents/                    # Agent 实现
│   ├── __init__.py
│   ├── ceo_agent.py          # CEO 协调 Agent
│   ├── content_planner.py    # 内容策划 Agent
│   ├── content_producer.py   # 内容生产 Agent
│   ├── data_analyst.py       # 数据分析 Agent
│   ├── publisher.py          # 发布执行 Agent
│   └── designer.py           # 素材设计 Agent
│
├── adapters/                  # 平台适配器
│   ├── __init__.py
│   ├── base.py               # 基础适配器
│   ├── zhihu.py              # 知乎适配器
│   ├── jianshu.py            # 简书适配器
│   ├── csdn.py               # CSDN 适配器
│   └── juejin.py             # 掘金适配器
│
├── models/                    # 数据模型
│   ├── __init__.py
│   ├── content.py            # 内容模型
│   ├── metrics.py            # 指标模型
│   └── task.py               # 任务模型
│
├── services/                  # 业务服务
│   ├── __init__.py
│   ├── llm_service.py        # LLM 调用服务
│   ├── storage_service.py    # 存储服务
│   └── scheduler_service.py  # 调度服务
│
├── utils/                     # 工具函数
│   ├── __init__.py
│   ├── logger.py             # 日志
│   └── config.py             # 配置
│
├── data/                      # 数据目录
│   ├── contents/             # 内容文件
│   ├── metrics.db            # SQLite 数据库
│   └── config.yaml           # 配置文件
│
├── tests/                     # 测试
│   ├── test_planner.py
│   ├── test_producer.py
│   └── test_publisher.py
│
├── main.py                    # 入口
├── pyproject.toml             # 项目配置
└── README.md
```

---

## 五、依赖清单

### 5.1 核心依赖

```toml
[project]
dependencies = [
    # LLM
    "anthropic>=0.40.0",
    
    # 数据存储
    "sqlalchemy>=2.0.0",
    "aiosqlite>=0.19.0",
    
    # 任务调度
    "apscheduler>=3.10.0",
    
    # Web 爬虫
    "playwright>=1.40.0",
    "beautifulsoup4>=4.12.0",
    "httpx>=0.26.0",
    
    # 数据处理
    "pydantic>=2.5.0",
    "pyyaml>=6.0.0",
    
    # 工具
    "rich>=13.0.0",  # 终端美化
    "loguru>=0.7.0",  # 日志
]

[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "pytest-asyncio>=0.21.0",
    "ruff>=0.1.0",
]
```

### 5.2 外部服务依赖

| 服务 | 用途 | 成本估算 |
|------|------|----------|
| Claude API | 内容生成 | $0.01-0.03/篇 |
| DALL-E 3 | 图片生成 | $0.04/张 |
| Unsplash API | 图库 | 免费 |

---

## 六、成本估算

### 6.1 开发成本

| 阶段 | 工作量 | 说明 |
|------|--------|------|
| Phase 1 (MVP) | 4周 | 核心功能 |
| Phase 2 (增强) | 4周 | 多平台+数据 |
| Phase 3 (完善) | 4周 | 策略+自动化 |

### 6.2 运行成本（月度）

| 项目 | 成本 | 说明 |
|------|------|------|
| Claude API | ~$50-100 | 500篇内容/月 |
| DALL-E 3 | ~$20 | 50张图/月 |
| 服务器 | $0 | 本地运行 |
| **总计** | ~$70-120/月 | |

---

## 七、技术风险

### 7.1 风险清单

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| API 限流 | 中 | 高 | 请求队列、多账号 |
| 平台反爬 | 中 | 中 | 模拟人工、IP 轮换 |
| 内容质量不稳定 | 中 | 高 | 人工审核、多轮优化 |
| 账号封禁 | 低 | 高 | 合规操作、分散账号 |

### 7.2 技术债务

| 项目 | 说明 | 处理时机 |
|------|------|----------|
| 单机部署限制 | 扩展时需要分布式 | Phase 3 |
| 同步调用阻塞 | 高并发时需要异步 | 按需优化 |
| 缺少监控 | 需要完善监控体系 | Phase 2 |

---

## 八、相关文档

| 文档 | 路径 |
|------|------|
| 需求文档 | 需求文档.md |
| 架构设计 | 架构设计.md |
| 开发计划 | 开发计划.md |

---

## 九、版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| V1.0 | 2026-02-27 | 初始版本 - 技术选型报告 |

---
name: system-maintenance
description: 系统环境维护 - Windows 维护、服务管理、性能监控
version: 1.0.0
parent: devops-engineer
---

# 系统环境维护

## Windows 系统维护

### 系统信息查看

```powershell
# 详细系统信息
systeminfo
Get-ComputerInfo

# Windows 版本
winver

# 系统启动时间
systeminfo | find "System Boot Time"
```

### 磁盘清理

```powershell
# 磁盘清理工具
cleanmgr /d C:

# 清理临时文件
Remove-Item -Path "C:\Windows\Temp\*" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item -Path "$env:TEMP\*" -Recurse -Force -ErrorAction SilentlyContinue

# 清理回收站
Clear-RecycleBin -Force

# 查看磁盘使用
Get-Volume
Get-PSDrive -PSProvider FileSystem

# 查看大文件/目录
# 需要先安装: winget install voidtools.Everything
# 或使用 TreeSize 等工具
```

### 系统文件检查

```powershell
# 系统文件检查器
sfc /scannow

# DISM 修复
DISM /Online /Cleanup-Image /CheckHealth
DISM /Online /Cleanup-Image /ScanHealth
DISM /Online /Cleanup-Image /RestoreHealth
```

### 进程管理

```powershell
# 查看所有进程
Get-Process
tasklist

# 查看端口占用
netstat -ano | findstr :端口号

# 结束进程
taskkill /PID 进程ID /F
taskkill /IM 进程名.exe /F

# 按 CPU/内存排序
Get-Process | Sort-Object CPU -Descending | Select-Object -First 10
Get-Process | Sort-Object WorkingSet -Descending | Select-Object -First 10
```

### 环境变量管理

```powershell
# 查看环境变量
[Environment]::GetEnvironmentVariable("PATH", "User")
[Environment]::GetEnvironmentVariable("PATH", "Machine")

# 设置用户环境变量
[Environment]::SetEnvironmentVariable("变量名", "值", "User")

# 设置系统环境变量（需管理员）
[Environment]::SetEnvironmentVariable("变量名", "值", "Machine")

# 临时设置（当前会话）
$env:变量名 = "值"

# 添加到 PATH
$currentPath = [Environment]::GetEnvironmentVariable("PATH", "User")
$newPath = "C:\新的路径"
[Environment]::SetEnvironmentVariable("PATH", "$currentPath;$newPath", "User")
```

## 服务管理

### 查看服务

```powershell
# 查看所有服务
Get-Service

# 查看运行中的服务
Get-Service | Where-Object {$_.Status -eq "Running"}

# 查看特定服务
Get-Service -Name 服务名

# 搜索服务
Get-Service | Where-Object {$_.DisplayName -like "*关键词*"}
```

### 控制服务

```powershell
# 启动服务
Start-Service 服务名
net start 服务名

# 停止服务
Stop-Service 服务名
net stop 服务名

# 重启服务
Restart-Service 服务名

# 暂停/恢复服务
Suspend-Service 服务名
Resume-Service 服务名
```

### 服务配置

```powershell
# 设置启动类型
Set-Service -Name 服务名 -StartupType Automatic  # 自动
Set-Service -Name 服务名 -StartupType Manual     # 手动
Set-Service -Name 服务名 -StartupType Disabled   # 禁用

# 使用 sc 命令
sc config 服务名 start= auto
sc config 服务名 start= demand
sc config 服务名 start= disabled
```

## 系统性能监控

### CPU 监控

```powershell
# 实时 CPU 使用率
Get-Counter '\Processor(_Total)\% Processor Time'

# 持续监控
Get-Counter '\Processor(_Total)\% Processor Time' -Continuous

# 获取进程 CPU 使用
Get-Process | Sort-Object CPU -Descending | Select-Object Name, CPU -First 10
```

### 内存监控

```powershell
# 内存使用情况
Get-Counter '\Memory\Available MBytes'
Get-Counter '\Memory\% Committed Bytes In Use'

# 进程内存使用
Get-Process | Sort-Object WorkingSet -Descending | Select-Object Name, @{N='Memory(MB)';E={[math]::Round($_.WorkingSet/1MB,2)}} -First 10

# 系统内存信息
$os = Get-CimInstance Win32_OperatingSystem
[PSCustomObject]@{
    TotalGB = [math]::Round($os.TotalVisibleMemorySize/1MB, 2)
    FreeGB = [math]::Round($os.FreePhysicalMemory/1MB, 2)
    UsedPercent = [math]::Round(($os.TotalVisibleMemorySize - $os.FreePhysicalMemory) / $os.TotalVisibleMemorySize * 100, 2)
}
```

### 磁盘监控

```powershell
# 磁盘空间
Get-Volume | Select-Object DriveLetter, FileSystemLabel, @{N='Size(GB)';E={[math]::Round($_.Size/1GB,2)}}, @{N='Free(GB)';E={[math]::Round($_.SizeRemaining/1GB,2)}}

# 磁盘读写
Get-Counter '\PhysicalDisk(_Total)\Disk Read Bytes/sec'
Get-Counter '\PhysicalDisk(_Total)\Disk Write Bytes/sec'

# 磁盘健康状态
Get-PhysicalDisk | Select-Object FriendlyName, MediaType, HealthStatus, OperationalStatus
```

### 网络监控

```powershell
# 网络流量
Get-Counter '\Network Interface(*)\Bytes Total/sec'

# 网络连接
Get-NetTCPConnection | Group-Object State | Select-Object Name, Count

# 网络适配器信息
Get-NetAdapter | Select-Object Name, Status, LinkSpeed, MacAddress
```

## 系统优化

### 禁用不必要的服务

```powershell
# 打印服务（如不需要打印机）
Stop-Service Spooler
Set-Service Spooler -StartupType Disabled

# Xbox 相关服务
Get-Service | Where-Object {$_.Name -like "Xbox*"} | ForEach-Object {
    Stop-Service $_.Name
    Set-Service $_.Name -StartupType Disabled
}

# 地理位置服务
Stop-Service lfsvc
Set-Service lfsvc -StartupType Disabled
```

### 禁用开机启动项

```powershell
# 查看启动项
Get-CimInstance Win32_StartupCommand | Select-Object Name, Command, Location

# 通过注册表
Get-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"
Get-ItemProperty "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run"

# 删除启动项
Remove-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "项目名"
```

### 电源优化

```powershell
# 查看电源计划
powercfg /list

# 设置高性能模式
powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c

# 关闭休眠（释放磁盘空间）
powercfg /hibernate off

# 设置显示器关闭时间（分钟）
powercfg /change monitor-timeout-ac 10
powercfg /change monitor-timeout-dc 5
```

# 底层执行示例库

> 本文档是底层执行能力.md 的详细示例补充
> 核心操作请参考：[底层执行能力.md](底层执行能力.md)

---

## 一、文档操作详细示例

### 1.1 读取操作详解

#### 场景：读取任务分配文档

```json
// 完整参数示例
mcp__filesystem__read_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md"
})
```

**预期输出结构**：
```markdown
| 任务ID | 描述 | 状态 | 负责人 | 截止日期 |
|--------|------|------|--------|----------|
| v2.3.1.1 | 创建模块 | 已完成 | ceo-coach | 2026-02-26 |
```

**错误处理**：
```json
// 如果 MCP 读取失败，切换到内置工具
Read({
  "file_path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md"
})
```

#### 场景：批量读取多个文件

```json
// 并行读取多个文件（单次响应中）
mcp__filesystem__read_file({ "path": "路径1" })
mcp__filesystem__read_file({ "path": "路径2" })
mcp__filesystem__read_file({ "path": "路径3" })
```

**注意事项**：
- 独立操作可并行执行
- 有依赖关系必须串行

### 1.2 写入操作详解

#### 场景：创建新的协调记录

```json
mcp__filesystem__write_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/协调记录.md",
  "content": "# 协调记录\n\n## COORD-2026-02-26-001\n\n**时间**: 2026-02-26T10:00:00\n**类型**: 任务分配协调\n**参与者**: ceo-coach, opc-ceo-core\n**主题**: 底层执行能力文档补充\n**内容**: ...\n**结果**: 成功分配任务\n**后续行动**: 无\n"
})
```

#### 场景：更新执行日志

```json
mcp__filesystem__write_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/执行日志/2026-02-26.md",
  "content": "# 执行日志 - 2026-02-26\n\n## 完成的任务\n- v2.3.1.1 创建底层执行能力.md\n- v2.3.1.2 创建执行工具速查卡.md\n\n## 决策记录\n- DECISION-2026-02-26-001: 使用 MCP 工具优先策略\n\n## 问题与解决\n- 无\n\n## 下一步\n- v2.3.2.1 验证 V4.0 能力\n"
})
```

### 1.3 编辑操作详解

#### 场景：更新任务状态

```json
// 精确替换特定内容
mcp__filesystem__edit_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md",
  "old_string": "| v2.3.1.1 | 创建底层执行能力.md | 待执行 | ceo-coach | 2026-02-26 |",
  "new_string": "| v2.3.1.1 | 创建底层执行能力.md | 已完成 | ceo-coach | 2026-02-26 |"
})
```

#### 场景：追加新任务

```json
// 在标记位置追加
mcp__filesystem__edit_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md",
  "old_string": "<!-- 新任务在此添加 -->",
  "new_string": "| v2.4.1.1 | 新增能力模块 | 待执行 | ceo-coach | 2026-02-27 |\n\n<!-- 新任务在此添加 -->"
})
```

---

## 二、Memory 操作详细示例

### 2.1 创建实体详解

#### 场景：创建任务实体（完整版）

```json
mcp__memory__create_entities({
  "entities": [
    {
      "name": "TASK-v2.3.1.1",
      "entityType": "Task",
      "observations": [
        "description: 创建 Coach 底层执行能力.md",
        "detail: 包含文档操作、Memory 操作、MCP 工具使用规范",
        "status: completed",
        "assignedTo: ceo-coach",
        "priority: high",
        "createdAt: 2026-02-26T10:00:00",
        "dueDate: 2026-02-26",
        "completedAt: 2026-02-26T11:30:00",
        "result: 成功创建 1212 行文档",
        "relatedFiles: 底层执行能力.md"
      ]
    }
  ]
})
```

#### 场景：创建决策记录

```json
mcp__memory__create_entities({
  "entities": [
    {
      "name": "DECISION-2026-02-26-001",
      "entityType": "Decision",
      "observations": [
        "context: Coach 能力增强计划",
        "trigger: V4.0 进化报告承诺",
        "decision: 创建底层执行能力.md 文档",
        "reason: 提升 Coach 独立执行底层操作的能力",
        "alternatives: [不创建, 简化版, 完整版]",
        "chosenAlternative: 完整版",
        "impact: Coach 能够独立完成所有底层操作",
        "risks: 文档可能过长",
        "timestamp: 2026-02-26T10:00:00",
        "madeBy: ceo-coach"
      ]
    }
  ]
})
```

#### 场景：创建进化记录

```json
mcp__memory__create_entities({
  "entities": [
    {
      "name": "COACH-EVOLUTION-2026-02-26-001",
      "entityType": "CoachEvolution",
      "observations": [
        "fromVersion: V3.0",
        "toVersion: V4.0",
        "type: capability_improvement",
        "area: execution_capability",
        "change: 新增底层执行能力.md 模块，包含完整的文档和 Memory 操作指南",
        "filesCreated: 底层执行能力.md",
        "filesModified: SKILL.md",
        "status: completed",
        "startedAt: 2026-02-26T10:00:00",
        "completedAt: 2026-02-26T12:00:00",
        "verifiedAt: 2026-02-26T12:30:00",
        "result: 成功"
      ]
    }
  ]
})
```

#### 场景：批量创建实体

```json
// 同时创建多个任务实体
mcp__memory__create_entities({
  "entities": [
    {
      "name": "TASK-v2.3.1.1",
      "entityType": "Task",
      "observations": ["description: 任务1", "status: pending"]
    },
    {
      "name": "TASK-v2.3.1.2",
      "entityType": "Task",
      "observations": ["description: 任务2", "status: pending"]
    },
    {
      "name": "TASK-v2.3.1.3",
      "entityType": "Task",
      "observations": ["description: 任务3", "status: pending"]
    }
  ]
})
```

### 2.2 查询实体详解

#### 场景：启动自检 - 检查 Memory 状态

```json
mcp__memory__search_nodes({
  "query": "company status task project"
})
```

**预期输出**：
- 如果有数据：返回实体列表
- 如果为空：需要从文档重建

#### 场景：查找特定类型的所有实体

```json
// 查找所有任务
mcp__memory__search_nodes({
  "query": "Task"
})

// 查找所有决策
mcp__memory__search_nodes({
  "query": "Decision"
})

// 查找所有进化记录
mcp__memory__search_nodes({
  "query": "CoachEvolution"
})
```

#### 场景：按时间范围查找

```json
// 查找今天的决策
mcp__memory__search_nodes({
  "query": "DECISION-2026-02-26"
})

// 查找本周的任务
mcp__memory__search_nodes({
  "query": "TASK-v2.3"
})
```

### 2.3 更新实体详解

#### 场景：更新任务状态

```json
mcp__memory__add_observations({
  "observations": [
    {
      "entityName": "TASK-v2.3.1.1",
      "contents": [
        "status: completed",
        "completedAt: 2026-02-26T11:00:00",
        "result: 成功创建底层执行能力.md",
        "linesWritten: 1212"
      ]
    }
  ]
})
```

#### 场景：批量更新多个实体

```json
mcp__memory__add_observations({
  "observations": [
    {
      "entityName": "TASK-v2.3.1.1",
      "contents": ["status: completed"]
    },
    {
      "entityName": "TASK-v2.3.1.2",
      "contents": ["status: in_progress"]
    }
  ]
})
```

### 2.4 创建关系详解

#### 场景：建立任务与决策的关系

```json
mcp__memory__create_relations({
  "relations": [
    {
      "from": "TASK-v2.3.1.1",
      "to": "DECISION-2026-02-26-001",
      "relationType": "triggered_by"
    }
  ]
})
```

**常用关系类型**：
| 关系类型 | 用途 |
|----------|------|
| triggered_by | A 由 B 触发 |
| depends_on | A 依赖 B |
| results_in | A 导致 B |
| relates_to | A 与 B 相关 |
| assigned_to | A 分配给 B |

---

## 三、场景完整示例

### 3.1 启动自检完整流程

```json
// 步骤1: 检查 Memory 状态
mcp__memory__search_nodes({ "query": "company status task project" })
// 判断: 若返回空，执行重建流程

// 步骤2: 检查 Git 状态
Bash({ "command": "git status" })
// 判断: 若有未提交变更，记录到日志

// 步骤3: 检查待办任务
mcp__filesystem__read_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md"
})
// 判断: 识别未完成任务

// 步骤4: 检查战略目标
mcp__filesystem__read_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/战略规划/战略目标.md"
})
// 判断: 确认文档存在且可读
```

### 3.2 Memory 重建完整流程

```json
// 步骤1: 读取任务文档
mcp__filesystem__read_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md"
})

// 步骤2: 解析并创建实体（假设解析出以下任务）
mcp__memory__create_entities({
  "entities": [
    {
      "name": "TASK-v2.3.1.1",
      "entityType": "Task",
      "observations": [
        "description: 创建底层执行能力.md",
        "status: pending",
        "assignedTo: ceo-coach"
      ]
    },
    {
      "name": "TASK-v2.3.1.2",
      "entityType": "Task",
      "observations": [
        "description: 创建执行工具速查卡.md",
        "status: pending",
        "assignedTo: ceo-coach"
      ]
    }
  ]
})

// 步骤3: 读取战略目标
mcp__filesystem__read_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/战略规划/战略目标.md"
})

// 步骤4: 创建目标实体
mcp__memory__create_entities({
  "entities": [
    {
      "name": "GOAL-Q1-2026",
      "entityType": "Goal",
      "observations": [
        "period: Q1-2026",
        "description: 完成 V2 Agent 协作系统",
        "status: in_progress"
      ]
    }
  ]
})
```

### 3.3 任务记录完整流程

```json
// 步骤1: 创建 Memory 实体
mcp__memory__create_entities({
  "entities": [
    {
      "name": "TASK-v2.4.1.1",
      "entityType": "Task",
      "observations": [
        "description: 优化风险评估流程",
        "status: pending",
        "assignedTo: ceo-coach",
        "priority: medium",
        "createdAt: 2026-02-26T12:00:00",
        "dueDate: 2026-02-27"
      ]
    }
  ]
})

// 步骤2: 更新任务分配文档
mcp__filesystem__edit_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md",
  "old_string": "<!-- 新任务在此添加 -->",
  "new_string": "| v2.4.1.1 | 优化风险评估流程 | 待执行 | ceo-coach | 2026-02-27 |\n\n<!-- 新任务在此添加 -->"
})

// 步骤3: 创建决策记录（如有）
mcp__memory__create_entities({
  "entities": [
    {
      "name": "DECISION-2026-02-26-002",
      "entityType": "Decision",
      "observations": [
        "context: 风险评估流程优化",
        "decision: 创建新任务进行流程优化",
        "reason: 当前风险评估不够系统化",
        "timestamp: 2026-02-26T12:00:00"
      ]
    }
  ]
})

// 步骤4: 建立关系
mcp__memory__create_relations({
  "relations": [
    {
      "from": "TASK-v2.4.1.1",
      "to": "DECISION-2026-02-26-002",
      "relationType": "triggered_by"
    }
  ]
})
```

### 3.4 进化记录完整流程

```json
// 步骤1: 创建进化记录
mcp__memory__create_entities({
  "entities": [
    {
      "name": "COACH-EVOLUTION-2026-02-26-001",
      "entityType": "CoachEvolution",
      "observations": [
        "fromVersion: V3.0",
        "toVersion: V4.0",
        "type: capability_improvement",
        "area: execution_capability",
        "change: 新增底层执行能力.md 模块",
        "status: completed",
        "timestamp: 2026-02-26T11:00:00"
      ]
    }
  ]
})

// 步骤2: 更新 Skill 模块索引（通过编辑 SKILL.md）
mcp__filesystem__edit_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/.claude/skills/ceo-coach/SKILL.md",
  "old_string": "version: 3.0.0",
  "new_string": "version: 4.0.0"
})

// 步骤3: 记录到执行日志
mcp__filesystem__write_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/执行日志/2026-02-26.md",
  "content": "# 执行日志 - 2026-02-26\n\n## 进化记录\n- V3.0 → V4.0: 新增底层执行能力模块\n"
})
```

### 3.5 风险预警检测流程

```json
// 步骤1: 读取任务分配文档
mcp__filesystem__read_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md"
})

// 步骤2: 分析任务状态（假设检测到延期任务）

// 步骤3: 创建预警记录
mcp__memory__create_entities({
  "entities": [
    {
      "name": "RISK-2026-02-26-001",
      "entityType": "RiskAlert",
      "observations": [
        "type: task_delay",
        "taskId: TASK-v2.3.1.1",
        "severity: medium",
        "detectedAt: 2026-02-26T14:00:00",
        "action: 记录到问题清单，提醒用户",
        "status: pending"
      ]
    }
  ]
})

// 步骤4: 记录到问题清单
mcp__filesystem__edit_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/问题清单.md",
  "old_string": "<!-- 新问题在此添加 -->",
  "new_string": "## RISK-2026-02-26-001\n**类型**: 任务延期\n**严重程度**: 中\n**任务ID**: TASK-v2.3.1.1\n**检测时间**: 2026-02-26T14:00:00\n**处理状态**: 待处理\n\n<!-- 新问题在此添加 -->"
})
```

---

## 四、错误处理详细示例

### 4.1 MCP 工具不可用

**场景**：调用 mcp__filesystem__read_file 失败

**处理流程**：
```
1. 记录错误信息到执行日志
2. 使用备选工具 Read
3. 如果仍失败，通知用户
```

**代码示例**：
```json
// 尝试 MCP 工具（假设失败）
// 切换到备选方案
Read({
  "file_path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md"
})

// 如果仍失败，记录错误
mcp__filesystem__write_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/执行日志/错误日志.md",
  "content": "# 错误日志\n\n## 2026-02-26T15:00:00\n**错误**: 文档读取失败\n**路径**: docs/沟通文档/任务分配.md\n**处理**: 尝试了 MCP 和内置工具均失败\n**需要用户**: 检查文件是否存在\n"
})
```

### 4.2 Memory 返回空

**场景**：search_nodes 返回空结果

**处理流程**：
```
1. 执行 Memory 重建流程
2. 从文档读取数据
3. 创建必要的 Memory 实体
4. 验证重建成功
```

**代码示例**：参见 3.2 Memory 重建完整流程

### 4.3 文档写入失败

**场景**：write_file 返回错误

**处理流程**：
```
1. 检查路径是否存在
2. 检查父目录是否存在
3. 尝试创建缺失的目录
4. 再次尝试写入
5. 如果仍失败，使用备选工具 Write
```

**代码示例**：
```json
// 步骤1: 检查父目录
mcp__filesystem__list_directory({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档"
})

// 如果目录不存在，创建它
mcp__filesystem__create_directory({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/新目录"
})

// 再次尝试写入
mcp__filesystem__write_file({
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/新目录/文件.md",
  "content": "内容"
})

// 如果仍失败，使用 Write
Write({
  "file_path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/新目录/文件.md",
  "content": "内容"
})
```

### 4.4 实体已存在错误

**场景**：create_entities 报告实体已存在

**处理流程**：
```
1. 使用 search_nodes 确认实体存在
2. 使用 add_observations 更新而非创建
```

**代码示例**：
```json
// 步骤1: 确认实体存在
mcp__memory__search_nodes({
  "query": "TASK-v2.3.1.1"
})

// 步骤2: 使用更新操作
mcp__memory__add_observations({
  "observations": [
    {
      "entityName": "TASK-v2.3.1.1",
      "contents": ["status: completed", "completedAt: 2026-02-26T16:00:00"]
    }
  ]
})
```

---

## 五、搜索操作详细示例

### 5.1 文件名搜索（Glob）

```json
// 查找所有 markdown 文件
Glob({
  "pattern": "**/*.md",
  "path": "E:/workspaces_2026_python/OPC-CEO"
})

// 查找特定目录下的文件
Glob({
  "pattern": "docs/**/*.md",
  "path": "E:/workspaces_2026_python/OPC-CEO"
})

// 查找所有 SKILL.md 文件
Glob({
  "pattern": "**/SKILL.md",
  "path": "E:/workspaces_2026_python/OPC-CEO/.claude/skills"
})

// 查找版本规划文件
Glob({
  "pattern": "docs/版本规划/**/*.md",
  "path": "E:/workspaces_2026_python/OPC-CEO"
})
```

### 5.2 内容搜索（Grep）

```json
// 搜索任务 ID
Grep({
  "pattern": "v2\\.3\\.1",
  "path": "E:/workspaces_2026_python/OPC-CEO/docs",
  "output_mode": "content"
})

// 搜索并显示行号
Grep({
  "pattern": "status:",
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档",
  "output_mode": "content",
  "glob": "*.md",
  "-n": true
})

// 统计匹配数量
Grep({
  "pattern": "待执行",
  "path": "E:/workspaces_2026_python/OPC-CEO/docs/沟通文档/任务分配.md",
  "output_mode": "count"
})

// 搜索忽略大小写
Grep({
  "pattern": "COACH",
  "path": "E:/workspaces_2026_python/OPC-CEO/docs",
  "output_mode": "files_with_matches",
  "-i": true
})

// 显示上下文（前后各 2 行）
Grep({
  "pattern": "V10.0",
  "path": "E:/workspaces_2026_python/OPC-CEO/.claude/skills/ceo-coach",
  "output_mode": "content",
  "-C": 2
})
```

---

## 六、Git 操作详细示例

### 6.1 常用 Git 命令

```json
// 查看状态
Bash({ "command": "git status" })

// 查看差异
Bash({ "command": "git diff" })

// 查看特定文件差异
Bash({ "command": "git diff -- 文件路径" })

// 查看日志（最近 10 条）
Bash({ "command": "git log --oneline -10" })

// 查看当前分支
Bash({ "command": "git branch" })

// 查看远程仓库
Bash({ "command": "git remote -v" })

// 添加文件
Bash({ "command": "git add 文件路径" })

// 添加所有修改
Bash({ "command": "git add -A" })

// 提交
Bash({ "command": "git commit -m \"提交信息\"" })

// 查看暂存区
Bash({ "command": "git stash list" })
```

### 6.2 Git 操作最佳实践

```
1. 提交前先查看状态和差异
2. 使用有意义的提交信息
3. 按功能/模块分组提交
4. 避免提交临时文件
5. 定期同步远程仓库
```

---

## 七、版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| 1.0.0 | 2026-02-26 | 从底层执行能力.md 拆分，作为详细示例库 |

---

> ceo-coach V11.0 - 底层执行示例库

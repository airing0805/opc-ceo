# 系统演变决策

## 概述

本文档记录 OPC-CEO 系统从 V1 到 V2 的架构演变过程、关键决策点和未来规划。

---

## V1 架构回顾

### 设计目标

**核心理念**：基于 Claude Code Skills 系统，通过技能定义实现一人公司的全面管理。

**技术栈**：
- Claude Code Skills
- MCP Memory（数据层）
- 自然语言交互

### 架构组成

```
┌─────────────────────────────────────────────────────────────┐
│                  CEO (opc-ceo-core)                         │
│  - 决策协调                                                   │
│  - 教练能力（集成）                                           │
│  - 任务分发                                                   │
└────────────────────┬────────────────────────────────────────┘
                     │
    ┌────────────────┼────────────────┐
    │                │                │
    ▼                ▼                ▼
┌─────────┐    ┌─────────┐    ┌─────────┐
│ task    │    │ file    │    │knowledge│
│ manager │    │ manager │    │ manager │
└─────────┘    └─────────┘    └─────────┘
    │                │                │
    └────────────────┼────────────────┘
                     │
    ┌────────────────┼────────────────┐
    │                │                │
    ▼                ▼                ▼
┌─────────┐    ┌─────────┐    ┌─────────┐
│finance  │    │schedule │    │automation│
│ manager │    │ manager │    │ manager │
└─────────┘    └─────────┘    └─────────┘
                     │
                     ▼
          ┌──────────────────┐
          │claude-sdk-       │
          │executor          │
          └──────────────────┘
```

### 技能清单（V1）

| # | 技能名 | 文件数 | 优先级 | 状态 |
|---|--------|--------|--------|------|
| 1 | `opc-ceo-core` | 9 | 关键 | 已禁用 |
| 2 | `task-manager` | 5 | 关键 | 已禁用 |
| 3 | `file-manager` | 5 | 关键 | 已禁用 |
| 4 | `knowledge-manager` | 5 | 高 | 已禁用 |
| 5 | `finance-manager` | 5 | 中 | 已禁用 |
| 6 | `schedule-manager` | 5 | 中 | 已禁用 |
| 7 | `automation-manager` | 4 | 中 | 已禁用 |
| 8 | `claude-sdk-executor` | 5 | 关键 | 待移动 |
| 9 | `wellness-coach` | 5 | 高 | 已禁用 |

---

## V1 实施进展

### 已完成

- ✅ `devops-engineer` - 运维支撑（独立于 V1 体系）
- ✅ V1 架构设计文档完成
- ✅ 技能模板规范定义
- ✅ 角色设计文档完成

### 未完成

- ❌ 8 个执行角色技能的完整实现
- ❌ MCP Memory 集成
- ❌ 技能间协作机制
- ❌ claude-sdk-executor 开发

---

## 演变触发点

### 问题识别（2026-02-24）

**问题 1：SDK 嵌套调用限制**

尝试通过 `claude-sdk-executor` 实现 agent 调用 agent，但遇到 SDK 嵌套检测限制：
```
Error: Claude SDK does not support nested calls
```

**问题 2：文档沟通不足**

用户反馈：
1. CEO 不应该从 README 找任务执行
2. 所有角色的沟通必须通过 MD 文档
3. 每个角色可以定期更新自己的 memory
4. 角色间沟通必须通过文档
5. 我与 CEO 的沟通内容用文档记录
6. 公司运营的内容都通过文档沟通，留下痕迹
7. 用户必须能看到所有痕迹

**问题 3：复杂度担忧**

V1 需要为每个角色定义完整的 Skill，涉及大量文档编写和维护。

---

## V2 架构设计

### 核心转变

**从 Skill 优先到 Agent 协作**

| 维度 | V1 (Skill) | V2 (Agent) |
|------|------------|------------|
| 实现方式 | 编写 Skill 文档 | 使用原生 Task 工具 |
| 角色定义 | 独立 Skill | Prompt 指导通用 agent |
| 数据共享 | MCP Memory | TaskList |
| 沟通机制 | 通过 CEO 中转 | Team + SendMessage |
| 维护成本 | 高（需要维护大量 Skill） | 低（维护核心 prompt） |

### V2 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        CEO (原生)                           │
│  - 决策协调                                                   │
│  - 文档沟通                                                   │
│  - 任务分发                                                   │
└────────────────────┬────────────────────────────────────────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ▼           ▼           ▼
    ┌─────────┐ ┌─────────┐ ┌─────────┐
    │ Task    │ │ Team    │ │ TaskList│
    │ 工具调用 │ │ 并行协作 │ │ 任务追踪 │
    └────┬────┘ └────┬────┘ └────┬────┘
         │           │           │
         └───────────┼───────────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ▼           ▼           ▼
    ┌─────────┐ ┌─────────┐ ┌─────────┐
    │general- │ │general- │ │general- │
    │purpose  │ │purpose  │ │purpose  │
    │ agent   │ │ agent   │ │ agent   │
    └─────────┘ └─────────┘ └─────────┘
         │           │           │
         └───────────┼───────────┘
                     │
              ┌──────┴──────┐
              │  文档沟通    │
              │  docs/沟通文档/ │
              └─────────────┘
```

### V2 技术栈

| 组件 | 说明 |
|------|------|
| CEO | 原生角色，负责协调 |
| Task 工具 | 调用 subagents |
| Team | 多 agent 并行协作 |
| SendMessage | Agent 间通信 |
| TaskList/TaskUpdate | 任务状态管理 |
| 文档沟通 | 所有沟通记录到 MD 文档 |

---

## 关键决策

### 决策 1：禁用所有 V1 技能（2026-02-24）

**决策内容**：
- 将所有 V1 技能移动到 `.claude/skills/disabled/` 目录
- 保留 `ceo-coach` 用于指导 CEO 成长

**决策理由**：
1. 避免同时维护 Skill 和 Agent 两套体系
2. 简化系统复杂度
3. 聚焦验证 V2 架构的可行性

**决策影响**：
- 简化项目结构
- 降低维护成本
- 如果 V2 失败，可以快速恢复 V1

### 决策 2：引入文档沟通规范（2026-02-24）

**决策内容**：
- 所有角色间沟通必须通过 MD 文档
- 创建 `docs/沟通文档/` 目录
- 定义标准文档格式

**决策理由**：
1. 响应用户差评反馈
2. 提供可追溯的运营记录
3. 方便用户查看所有痕迹

**决策影响**：
- 增加文档编写负担
- 但极大提升透明度
- 便于后续分析和审计

### 决策 3：CEO 集成教练能力（V1 时期）

**决策内容**：
- CEO 内置教练能力，而非独立教练角色
- 当 CEO 无法承担时，再考虑招聘专项教练

**决策理由**：
1. 简化架构
2. CEO 本身就有指导和评估能力
3. 减少角色数量

**决策影响**：
- 减少角色复杂度
- CEO 职责更集中

### 决策 4：使用 Task 工具而非自定义 Agent（V2）

**决策内容**：
- 直接使用 Task 工具 + prompt 调用通用 agents
- 不为每个角色创建独立 Agent 文件

**决策理由**：
1. Task 工具更简单直接
2. Prompt 足够指导 agent 行为
3. 避免过度工程化

**决策影响**：
- 减少文件数量
- 灵活性更高
- 如果需要，后续可以创建独立 Agent

---

## 演变时间线

| 时间 | 事件 | 影响 |
|------|------|------|
| 2026-02-23 | 完成 V1 架构设计文档 | 确立 V1 规划 |
| 2026-02-23 | 尝试实现 claude-sdk-executor | 发现嵌套调用限制 |
| 2026-02-24 | 用户反馈沟通问题 | 促使架构调整 |
| 2026-02-24 | 设计 V2 架构 | 完成架构转变设计 |
| 2026-02-24 | 完成 V2.1 - V2.4 规划 | 定义实施阶段 |
| 2026-02-24 | 禁用 V1 技能 | 清理项目结构 |
| 2026-02-24 | 创建文档沟通规范 | 建立沟通基础 |
| 未来 | 验证 V2 可行性 | 确定最终方向 |

---

## V2 实施阶段

### V2.1 - 创建自定义 Agents ✅

**目标**：将现有 Skills 映射为 Claude Code Agents

**状态**：已完成

**关键点**：
- 定义 Agent 路径
- 设定工具权限
- 明确各 Agent 职责

### V2.2 - 直接使用 Task 工具 ✅

**目标**：不创建新 agent 文件，CEO 直接使用 Task 工具 + 现有 skill 文档

**状态**：已完成

**关键点**：
- 设计 Task 调用模板
- 定义 prompt 规范
- 创建调用模板文档

### V2.3 - Team 协作模式 ✅

**目标**：使用 Team + TaskList 实现多 agent 并行协作

**状态**：已完成

**关键点**：
- 设计 Team 协作架构
- 创建 Team 配置
- 设计 SendMessage 协作

### V2.4 - 文档沟通规范 ✅

**目标**：建立文档沟通规范，所有角色间沟通通过 MD 文档

**状态**：已完成（部分）

**关键点**：
- 创建文档目录结构
- 定义文档格式规范
- 更新 CEO SKILL.md

---

## 未来规划

### 短期（V2 完成后 1-2 个月）

**目标**：验证 V2 架构

1. **测试验证**
   - 测试 Task 工具调用
   - 验证 Team 协作
   - 检查文档沟通流程

2. **收集反馈**
   - 用户满意度调查
   - 性能测试
   - 成本分析

3. **优化调整**
   - 根据反馈优化 prompt
   - 调整协作流程
   - 完善文档规范

### 中期（3-6 个月）

**目标**：确定最终架构

| 路径 | 条件 | 方案 |
|------|------|------|
| 路径 A | V2 满足需求 | 继续优化 V2 |
| 路径 B | 部分能力不足 | 混合 V2 + V1 核心技能 |
| 路径 C | V2 不适用 | 恢复 V1，改进协作机制 |

### 长期（6-12 个月）

**目标**：稳定运营

1. **架构稳定**
   - 确定最终架构
   - 完善核心能力
   - 建立扩展机制

2. **能力扩展**
   - 外部集成（日历、邮件等）
   - 自动化工作流
   - 数据分析能力

3. **用户增长**
   - 提升易用性
   - 优化性能
   - 扩展应用场景

---

## 风险与缓解

### 风险 1：V2 架构不可行

**描述**：Task 工具 + prompt 无法满足复杂需求

**缓解措施**：
- 保留 V1 技能在 disabled 目录
- 设计混合模式（V2 + 关键 V1 技能）
- 设置回退计划

### 风险 2：文档沟通负担过重

**描述**：所有沟通都要写文档，增加工作量

**缓解措施**：
- 设计简洁的文档模板
- 自动生成部分文档
- 优化文档更新流程

### 风险 3：用户体验下降

**描述**：V2 架构比 V1 更复杂，用户难以理解

**缓解措施**：
- 提供清晰的文档
- 设计友好的交互界面
- 提供培训和支持

---

## 成功标准

### V2 验收标准

- [ ] Task 工具可以正常调用 agents
- [ ] Team 协作可以并行执行
- [ ] 文档沟通规范正常运行
- [ ] 用户可以看到所有沟通痕迹
- [ ] 系统复杂度低于 V1
- [ ] 维护成本低于 V1

### 长期成功标准

- 用户满意度 > 80%
- 系统稳定性 > 95%
- 任务完成率 > 90%
- 文档完整性 > 95%

---

## 相关文档

- [V1 版本规划总览](../v1-技能规划/总览.md) - V1 架构设计
- [V2 README](README.md) - V2 架构规划
- [技能禁用说明](技能禁用说明.md) - V1 技能禁用详情
- [文档沟通规范](../../沟通文档/文档沟通规范.md) - 沟通规范定义
- [设计意图](../v1-技能规划/设计意图.md) - 设计原则和依据

---

## 版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0 | 2026-02-24 | 初始版本，记录 V1 到 V2 的演变过程 |

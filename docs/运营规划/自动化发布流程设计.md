# 自动化发布流程设计

> 版本：v1.0
> 创建日期：2026-02-28
> 关联任务：v5.3.4 发布Agent开发
> 状态：**待开发**

---

## 一、当前发布流程分析

### 1.1 现有流程

```
选题 → AI生成草稿 → 去AI味优化 → 存草稿箱 → 质量验证 → 正式发布
```

### 1.2 痛点分析

| 痛点 | 影响 | 优先级 |
|------|------|--------|
| 完全手动操作 | 耗时长，无法规模化 | P0 |
| 依赖Chrome登录 | 每日需检查登录状态 | P0 |
| 人工检查质量 | 效率低，容易遗漏 | P1 |
| 数据采集分散 | 各平台独立操作 | P2 |
| 无异常处理 | 发布失败需人工介入 | P1 |

### 1.3 自动化目标

| 维度 | 当前 | 目标 | 提升 |
|------|------|------|------|
| 每日发布量 | 0篇(手动) | 2篇 | 自动化 |
| 发布耗时 | 30分钟/篇 | 5分钟/篇 | 6倍 |
| 人工介入 | 100% | 20% | 80%自动化 |
| 登录检查 | 手动 | 自动 | 自动化 |

---

## 二、自动化发布框架设计

### 2.1 系统架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                        自动化发布系统 v1.0                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                      调度层 (Scheduler)                      │   │
│   │         每日定时触发 / 手动触发 / 事件触发                     │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│                                ▼                                    │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                      编排层 (Orchestrator)                   │   │
│   │              任务队列管理 / 流程编排 / 状态跟踪                │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                │                                    │
│          ┌─────────────────────┼─────────────────────┐             │
│          ▼                     ▼                     ▼             │
│   ┌─────────────┐       ┌─────────────┐       ┌─────────────┐      │
│   │ 发布Agent    │       │ 质量Agent   │       │ 数据Agent   │      │
│   │ (Publisher) │       │ (Quality)   │       │ (Analytics)│      │
│   └─────────────┘       └─────────────┘       └─────────────┘      │
│          │                     │                     │             │
│          └─────────────────────┼─────────────────────┘             │
│                                │                                    │
│                                ▼                                    │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                      MCP工具层                               │   │
│   │  Playwright | Memory | Filesystem | Chrome DevTools        │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 核心模块

| 模块 | 职责 | 关键技术 |
|------|------|----------|
| 调度层 | 定时/手动触发任务 | Cron表达式 / 事件监听 |
| 编排层 | 流程编排、状态管理 | 状态机 / 消息队列 |
| 发布Agent | 浏览器自动化发布 | Playwright MCP |
| 质量Agent | 内容质量检测 | Claude API |
| 数据Agent | 数据采集分析 | 爬虫 / API |

### 2.3 发布Agent模块结构

```
PublisherAgent/
├── SKILL.md                    # 技能入口
├── 任务操作.md                 # 发布任务操作
├── 登录管理.md                 # 登录状态管理
├── 草稿箱管理.md              # 草稿箱操作
├── 发布执行.md                 # 实际发布操作
└── 异常处理.md                # 异常处理流程
```

---

## 三、发布Agent详细设计

### 3.1 核心能力

| 能力 | 说明 | 优先级 |
|------|------|--------|
| 登录状态检测 | 自动检查CSDN登录状态 | P0 |
| 草稿箱发布 | 发布文章到草稿箱 | P0 |
| 正式发布 | 从草稿箱发布到正式 | P0 |
| 登录引导 | 登录失效时引导用户 | P1 |
| 验证码处理 | 验证码识别/引导 | P2 |
| 发布验证 | 确认发布成功 | P1 |

### 3.2 任务流程

```
┌─────────────────────────────────────────────────────────────────┐
│                     发布Agent任务流程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  触发: 收到发布任务                                             │
│                                                                 │
│  Step 1: 登录检查                                               │
│    ├─ 检查Cookie有效性                                          │
│    ├─ 检查登录状态                                               │
│    └─ [失效] → 引导用户登录 → 重试                              │
│                                                                 │
│  Step 2: 内容准备                                               │
│    ├─ 读取待发布内容                                             │
│    ├─ 格式转换(Markdown → HTML)                                 │
│    └─ 提取标题/标签/分类                                        │
│                                                                 │
│  Step 3: 草稿箱发布                                             │
│    ├─ 打开CSDN编辑器                                            │
│    ├─ 填写标题                                                  │
│    ├─ 填写内容                                                  │
│    ├─ 选择分类/标签                                             │
│    └─ 保存到草稿箱                                              │
│                                                                 │
│  Step 4: 发布验证                                               │
│    ├─ 检查草稿箱状态                                             │
│    ├─ 记录发布结果                                              │
│    └─ 更新任务状态                                              │
│                                                                 │
│  结束: 输出执行报告                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 登录管理模块

```yaml
模块: 登录管理
功能:
  - 检查登录状态
  - 保持登录状态
  - 处理登录失效

检查逻辑:
  1. 访问CSDN首页
  2. 检查个人头像是否存在
  3. 检查Cookie中的登录标识

失效处理:
  1. 记录登录失效事件
  2. 通知用户登录
  3. 暂停发布任务
  4. 用户登录后恢复
```

### 3.4 草稿箱管理模块

```yaml
模块: 草稿箱管理
功能:
  - 创建新草稿
  - 编辑草稿
  - 发布草稿
  - 删除草稿

操作流程:
  1. 访问创作中心
  2. 进入写博客页面
  3. 填写标题(title输入框)
  4. 填写正文(富文本编辑器)
  5. 选择分类
  6. 添加标签
  7. 点击发布按钮
```

### 3.5 异常处理策略

| 异常类型 | 检测方式 | 处理策略 |
|----------|----------|----------|
| 登录失效 | 头像消失/弹窗 | 暂停任务，通知用户 |
| 网络错误 | 请求超时 | 重试3次，间隔30秒 |
| 验证码 | 出现验证码 | 暂停任务，通知用户 |
| 内容违规 | 发布失败提示 | 记录原因，标记需修改 |
| 发布超时 | 5分钟无响应 | 重试或跳过 |

---

## 四、数据采集模块设计

### 4.1 采集目标

| 数据类型 | 数据项 | 采集频率 | 技术方案 |
|----------|--------|----------|----------|
| 发布数据 | 文章标题/发布时间/链接 | 实时 | Playwright |
| 流量数据 | 浏览量/点赞/收藏 | 每日 | 爬虫/API |
| 粉丝数据 | 粉丝数/新增 | 每日 | 爬虫/API |

### 4.2 数据存储

使用MCP Memory作为数据存储：

```json
{
  "entityType": "Article",
  "name": "文章ID",
  "observations": [
    "平台: CSDN",
    "标题: xxx",
    "发布时间: 2026-02-28",
    "链接: https://blog.csdn.net/xxx",
    "状态: 已发布"
  ]
}
```

### 4.3 数据采集流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    数据采集流程                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  定时触发: 每日 09:00                                           │
│                                                                 │
│  Step 1: 登录检查                                               │
│    └─ 检查各平台登录状态                                         │
│                                                                 │
│  Step 2: 内容数据采集                                            │
│    ├─ 采集已发布文章列表                                         │
│    └─ 记录新发布文章                                             │
│                                                                 │
│  Step 3: 流量数据采集                                            │
│    ├─ 采集文章阅读/点赞/收藏                                     │
│    └─ 采集粉丝变化                                               │
│                                                                 │
│  Step 4: 数据存储                                               │
│    ├─ 更新文章实体                                               │
│    └─ 生成每日报告                                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 五、技术依赖

### 5.1 必需工具

| 工具 | 用途 | 优先级 |
|------|------|--------|
| Playwright MCP | 浏览器自动化 | P0 |
| MCP Memory | 数据存储 | P0 |
| Chrome DevTools | 调试/截图 | P1 |

### 5.2 可选增强

| 工具 | 用途 | 优先级 |
|------|------|--------|
| Claude SDK | Agent执行 | P0 |
| 定时任务 | 自动化调度 | P1 |

### 5.3 技术风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 登录失效 | 无法发布 | 及时通知用户 |
| 平台改版 | 脚本失效 | 快速迭代适配 |
| 验证码 | 无法自动化 | 人工介入 |
| IP限制 | 请求被封 | 使用代理/降低频率 |

---

## 六、实施计划

### 6.1 开发阶段

| 阶段 | 任务 | 产出 | 优先级 |
|------|------|------|--------|
| Phase 1 | 登录状态检测模块 | 可检测登录状态 | P0 |
| Phase 2 | 草稿箱发布模块 | 可发布到草稿箱 | P0 |
| Phase 3 | 正式发布模块 | 可从草稿发布 | P1 |
| Phase 4 | 数据采集模块 | 可采集发布数据 | P2 |
| Phase 5 | 调度与编排 | 自动化流程 | P1 |

### 6.2 里程碑

| 里程碑 | 目标 | 自动化率 |
|--------|------|----------|
| M1 | 草稿箱发布自动化 | 60% |
| M2 | 正式发布自动化 | 80% |
| M3 | 数据采集自动化 | 85% |
| M4 | 全流程自动化 | 90% |

---

## 七、版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0 | 2026-02-28 | 初始版本，定义自动化发布框架 |

---

## 八、关联文档

| 文档 | 路径 |
|------|------|
| V5版本规划 | ../版本规划/v5-技能规划/README.md |
| 低验证门槛平台发布计划 | ./低验证门槛平台发布计划.md |
| 内容发布规范 | ./内容发布规范.md |
| 数据采集流程 | ./数据采集流程.md |

---

> 文档状态: 待开发
> 下一步: 由coach制定详细实现规范，CEO执行开发
